<!-- all-stats.html - 전체 회차 통계 -->
<div class="stats-content">
    <!-- 통계 요약 -->
    <div class="row mb-4">
        <div class="col-md-6 col-lg-3 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h5><i class="fas fa-info-circle"></i> 통계 요약</h5>
                </div>
                <div class="card-body">
                    <div class="stat-summary">
                        <div class="alert alert-info" id="all-summary">
                            <p><strong>최다 출현 번호:</strong> <span id="all-most-frequent">로딩 중...</span></p>
                            <p><strong>평균 당첨 합계:</strong> <span id="all-avg-sum">로딩 중...</span></p>
                            <p><strong>평균 AC값:</strong> <span id="all-avg-ac">로딩 중...</span></p>
                            <p><strong>홀짝 비율:</strong> <span id="all-odd-even">로딩 중...</span></p>
                            <p><strong>고저 비율:</strong> <span id="all-high-low">로딩 중...</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6 col-lg-3 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h5><i class="fas fa-trophy"></i> 상위 번호</h5>
                </div>
                <div class="card-body">
                    <div class="stat-summary">
                        <div class="stat-header">
                            <i class="fas fa-chart-bar"></i>
                            <h6>가장 많이 나온 번호</h6>
                        </div>
                        <div class="frequency-display" id="top-numbers-all">
                            <!-- 상위 번호가 여기에 동적으로 표시됩니다 -->
                        </div>

                        <div class="stat-header mt-3">
                            <i class="fas fa-chart-line"></i>
                            <h6>최근 뜨는 번호 (상승세)</h6>
                        </div>
                        <div class="frequency-display" id="trending-numbers-all">
                            <!-- 상승세 번호가 여기에 동적으로 표시됩니다 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6 col-lg-3 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h5><i class="fas fa-balance-scale"></i> 확률 분포</h5>
                </div>
                <div class="card-body">
                    <div class="stat-summary">
                        <div class="stat-header">
                            <i class="fas fa-percentage"></i>
                            <h6>이론상 확률</h6>
                        </div>
                        <div class="stat-value">1/8,145,060</div>
                        <div class="stat-badge neutral">
                            <i class="fas fa-dice"></i> 6개 번호 맞출 확률
                        </div>

                        <div class="stat-header mt-3">
                            <i class="fas fa-random"></i>
                            <h6>랜덤성 점수</h6>
                        </div>
                        <div class="stat-value" id="randomness-score-all">--</div>
                        <div class="stat-badge neutral" id="randomness-badge-all">
                            <i class="fas fa-info-circle"></i> 평가 중...
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6 col-lg-3 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h5><i class="fas fa-history"></i> 당첨 이력</h5>
                </div>
                <div class="card-body">
                    <div class="stat-summary">
                        <div class="stat-header">
                            <i class="fas fa-calendar-alt"></i>
                            <h6>총 회차 수</h6>
                        </div>
                        <div class="stat-value" id="total-draws-all">--</div>

                        <div class="stat-header mt-3">
                            <i class="fas fa-calendar-check"></i>
                            <h6>최근 당첨일</h6>
                        </div>
                        <div class="mb-2" id="latest-draw-date-all">--</div>

                        <a href="#" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-list"></i> 당첨 번호 전체 보기
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 번호 출현 빈도 차트 -->
    <div class="row mb-4">
        <div class="col-lg-8 mb-3">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-chart-bar"></i> 번호별 출현 빈도</h5>
                </div>
                <div class="card-body">
                    <div class="chart-container" id="frequencyChart">
                        <canvas id="frequency-chart-all"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h5><i class="fas fa-calculator"></i> 홀짝 & 고저 비율</h5>
                </div>
                <div class="card-body">
                    <div class="ratio-chart-container">
                        <div class="ratio-chart mb-4">
                            <div class="ratio-title">홀짝 비율</div>
                            <div class="chart-container small" id="oddEvenChart">
                                <canvas id="odd-even-chart-all"></canvas>
                            </div>
                            <div id="odd-even-summary-all" class="odd-even-summary mt-2">
                                <!-- 홀짝 요약 정보가 동적으로 표시됩니다 -->
                            </div>
                        </div>

                        <div class="ratio-chart">
                            <div class="ratio-title">고저 비율 (기준: 23번)</div>
                            <div class="chart-container small" id="highLowChart">
                                <canvas id="high-low-chart-all"></canvas>
                            </div>
                            <div id="high-low-summary-all" class="high-low-summary mt-2">
                                <!-- 고저 요약 정보가 동적으로 표시됩니다 -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AC값 및 합계 분포 차트 -->
    <div class="row mb-4">
        <div class="col-lg-6 mb-3">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-random"></i> AC값 분포 (복잡도)</h5>
                </div>
                <div class="card-body">
                    <div class="chart-container" id="acValueChart">
                        <canvas id="ac-value-chart-all"></canvas>
                    </div>
                    <div id="ac-summary-all" class="ac-summary mt-3">
                        <!-- AC값 요약 정보가 동적으로 표시됩니다 -->
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6 mb-3">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-plus-circle"></i> 합계 분포</h5>
                </div>
                <div class="card-body">
                    <div class="chart-container" id="sumChart">
                        <canvas id="sum-chart-all"></canvas>
                    </div>
                    <div id="sum-summary-all" class="sum-summary mt-3">
                        <!-- 합계 요약 정보가 동적으로 표시됩니다 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 번호 패턴 분석 차트 -->
    <div class="row mb-4">
        <div class="col-12 mb-3">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-puzzle-piece"></i> 번호 패턴 분석</h5>
                </div>
                <div class="card-body">
                    <ul class="nav nav-pills mb-3" id="patterns-tab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="consecutive-tab" data-bs-toggle="pill" data-bs-target="#consecutive-content" type="button" role="tab" aria-selected="true">연속번호</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="prime-tab" data-bs-toggle="pill" data-bs-target="#prime-content" type="button" role="tab" aria-selected="false">소수</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="multiple-tab" data-bs-toggle="pill" data-bs-target="#multiple-content" type="button" role="tab" aria-selected="false">배수</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="lastdigit-tab" data-bs-toggle="pill" data-bs-target="#lastdigit-content" type="button" role="tab" aria-selected="false">끝수</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="combination-tab" data-bs-toggle="pill" data-bs-target="#combination-content" type="button" role="tab" aria-selected="false">조합 패턴</button>
                        </li>
                    </ul>

                    <div class="tab-content" id="patterns-tab-content">
                        <!-- 연속번호 분석 -->
                        <div class="tab-pane fade show active" id="consecutive-content" role="tabpanel">
                            <div class="row">
                                <div class="col-lg-8">
                                    <div class="chart-container" id="consecutiveChart">
                                        <canvas id="consecutive-chart-all"></canvas>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="alert alert-info">
                                        <h6 class="alert-heading">연속번호 분석</h6>
                                        <p>당첨 번호에서 연속된 숫자 쌍이 얼마나 자주 등장하는지 분석합니다.</p>
                                        <p>예를 들어, [1, 2, 15, 23, 24, 45]에는 연속된 숫자 쌍이 2개 있습니다: (1-2), (23-24)</p>
                                        <hr>
                                        <p class="mb-0">실제 데이터에서는 <strong>연속 1쌍</strong>이 가장 많이 발생하며, 연속 2쌍 이상은 드물게 나타납니다.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 소수 분석 -->
                        <div class="tab-pane fade" id="prime-content" role="tabpanel">
                            <div class="row">
                                <div class="col-lg-8">
                                    <div class="chart-container" id="primeChart">
                                        <canvas id="prime-chart-all"></canvas>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="alert alert-info">
                                        <h6 class="alert-heading">소수 분석</h6>
                                        <p>당첨 번호 중 소수(1과 자신으로만 나누어지는 수)의 분포를 분석합니다.</p>
                                        <p>로또에서의 소수 번호: 2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43</p>
                                        <hr>
                                        <p class="mb-0">당첨 번호에는 평균적으로 <strong>2-3개</strong>의 소수가 포함되어 있습니다.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 배수 분석 -->
                        <div class="tab-pane fade" id="multiple-content" role="tabpanel">
                            <div class="row">
                                <div class="col-lg-8">
                                    <div class="chart-container" id="mult3Chart">
                                        <canvas id="mult3-chart-all"></canvas>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="alert alert-info">
                                        <h6 class="alert-heading">3의 배수 분석</h6>
                                        <p>당첨 번호 중 3의 배수가 얼마나 포함되어 있는지 분석합니다.</p>
                                        <p>로또에서 3의 배수: 3, 6, 9, 12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42, 45</p>
                                        <hr>
                                        <p class="mb-0">이론적으로 3의 배수는 전체 45개 번호 중 33.3%를 차지하므로, 6개 번호 중 약 <strong>2개</strong>가 3의 배수일 확률이 높습니다.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 끝수 분석 -->
                        <div class="tab-pane fade" id="lastdigit-content" role="tabpanel">
                            <div class="row">
                                <div class="col-lg-8">
                                    <div class="chart-container" id="lastDigitChart">
                                        <canvas id="lastdigit-chart-all"></canvas>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="alert alert-info">
                                        <h6 class="alert-heading">끝수 분석</h6>
                                        <p>당첨 번호의 일의 자리(끝수) 분포를 분석합니다.</p>
                                        <p>이상적으로는 0~9까지의 숫자가 균등하게 분포되어야 합니다.</p>
                                        <hr>
                                        <p class="mb-0">실제 데이터에서는 특정 끝수가 살짝 더 많이 나타나는 경향이 있지만, 큰 차이는 없습니다.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 조합 패턴 분석 -->
                        <div class="tab-pane fade" id="combination-content" role="tabpanel">
                            <div class="row">
                                <div class="col-lg-8">
                                    <div class="chart-container" id="combinationChart">
                                        <canvas id="combination-chart-all"></canvas>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="alert alert-info">
                                        <h6 class="alert-heading">번호대별 조합 패턴</h6>
                                        <p>당첨 번호가 각 번호대(1-10, 11-20 등)에서 몇 개씩 뽑히는지 분석합니다.</p>
                                        <p>예: "21120" 패턴은 1-10에서 2개, 11-20에서 1개, 21-30에서 1개, 31-40에서 2개, 41-45에서 0개가 나왔다는 의미입니다.</p>
                                        <hr>
                                        <p class="mb-0">가장 흔한 패턴은 각 구간에서 고르게 번호가 나오는 경우입니다.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 통계 초기화 스크립트 -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // 패턴 분석 탭 초기화
        const patternsTabs = document.getElementById('patterns-tab');
        if (patternsTabs) {
            const tabBtns = patternsTabs.querySelectorAll('[data-bs-toggle="pill"]');
            tabBtns.forEach(btn => {
                btn.addEventListener('shown.bs.tab', function(e) {
                    // 차트 리사이즈 트리거 (차트가 숨겨진 탭에 있을 때 크기 계산 오류 수정)
                    window.dispatchEvent(new Event('resize'));
                });
            });
        }

        // 통계 데이터 로드 이벤트 리스너
        document.addEventListener('tabDataLoaded', function(e) {
            if (e.detail.tabId === '#tab-all') {
                updateAllStatsUI(e.detail.data);
            }
        });

        // 전체 회차 통계 UI 업데이트
        function updateAllStatsUI(data) {
            if (!data) return;

            // 요약 정보 업데이트
            const summary = data.summary || {};
            if (summary) {
                document.getElementById('all-avg-sum').textContent = summary.avg_sum?.toFixed(1) || '--';
                document.getElementById('all-avg-ac').textContent = summary.avg_ac?.toFixed(1) || '--';
                document.getElementById('all-odd-even').textContent = summary.odd_even_ratio || '--';
                document.getElementById('all-high-low').textContent = summary.high_low_ratio || '--';
            }

            // 빈도수 기준 상위 번호 찾기
            const frequency = data.frequency || {};
            if (frequency) {
                const sortedNumbers = Object.entries(frequency)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5)
                    .map(([num, count]) => ({ number: parseInt(num), count }));

                if (sortedNumbers.length > 0) {
                    document.getElementById('all-most-frequent').textContent =
                        `${sortedNumbers[0].number}번 (${sortedNumbers[0].count}회)`;
                }
            }

            // 이 외에도 필요한 UI 요소 업데이트
            // ...
        }
    });
</script>